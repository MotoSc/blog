---
layout: post
title: "读书笔记《代码之髓：编程语言核心概念》 第六章"
date: 2016-07-15 16:51:38 +0800
categories:
---
# 第六章 错误处理
程序在执行过程中也有可能出错，出错时如何处理（错误处理）很重要。

错误处理的方法大体可分为两种:。

- 使用返回值
- 使用异常

## 程序也会出错

在文件写入时，如果磁盘空间不足写入操作就会失败。程序的出错也一样。写入文件时，如果没有任何警告，用户难以察觉。用户可能会误以为这些非常重要的数据已经成功写入磁盘中，从而删除了原始数据，所以程序设计语言需要具备一种错误的检测和传达机制。抛出错误的作用，是在检测险情并报警，在造成不堪设想的大灾难前做出处理。

## 如何传达错误

### 通过返回值传达出错误信息

`func`函数事先将返回值定义为成功执行时返回`0`,出错时返回`0`以外的值。函数调用方在调用func函数后，会检查其返回值，返回值非`0`时会进行错误处理。

``` C
if (func()){
    /*错误处理*/
}
```
也就是说，出错时把信息写入返回值，接着做返回值检查。与之相类似的有先行定义全局变量接收错误信息的方法。也就是说，出错时把信息写入返回值，接着做返回值检查。与之相反类似的有先行定义全局变量接收错误信息的方法，还有在函数调用方定义变量作为引用形参接受错误信息的方法。

以上两种方法在`C`语言中广泛使用，但是有两个问题:
1. 错误遗漏：忘记对返回值做错误检查，从而错过了错误。粗心大意可能导致忘记返回值检测可能出错。如此，检测函数调用完没有对返回值做检查，按照执行成功的固定思维进行编码。
2. 错误处理导致代码可读性下降：对所有函数调用都仔细做检查以免漏错，然后着手编写错误处理代码，由于处理，源代码会变得越来越难读懂。

``` C
int main(){
    if(func('a')){
        /* 失败时的错误处理 */
    } else if(func('b')) {
        /* 失败时的错误处理 */
    } else if(func('c')) {
        /* 失败时的错误处理 */
    }
    ...
    else {
        /* 失败时的错误处理 */
    }
}
```

优化操作：通过跳转集中进行错误处理。

``` C
int main(){
    if(!func('a')) goto ERROR;
    if(!func('b')) goto ERROR;
    if(!func('c')) goto ERROR;
    return;
    ERROR:
    /* 失败时的错误处理 */
}
```

### 出错则跳转

这种方法事先定义好错误发生时跳转的位置，后来演变成了现在的异常处理。

> 过去不叫失败或异常，叫条件(condition)。另外，抛出异常的命令也不是现在一般的raise或throw，而是signal。
